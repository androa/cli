apiVersion: v1
kind: Pod
metadata:
  annotations:
    cluster-autoscaler.kubernetes.io/safe-to-evict: "true"
    cni.projectcalico.org/containerID: add9495f4ddcc70a1f2f23e0da46d1facff93df8b1d9f50367819639a47941a3
    cni.projectcalico.org/podIP: 10.6.101.59/32
    cni.projectcalico.org/podIPs: 10.6.101.59/32
    kubectl.kubernetes.io/default-container: pensjon-kafka-inst
    kubernetes.io/psp: istio
    linkerd.io/created-by: linkerd/proxy-injector stable-2.11.1
    linkerd.io/identity-mode: default
    linkerd.io/proxy-version: stable-2.11.1
    policies.kyverno.io/last-applied-patches: |
      Replace legacy Github registry container.replace-legacy-github-registry.kyverno.io: removed
        /spec/containers/1/securityContext
    prometheus.io/path: /metrics
    prometheus.io/port: "8080"
    prometheus.io/scrape: "true"
    viz.linkerd.io/tap-enabled: "true"
  creationTimestamp: "2022-06-23T13:46:19Z"
  generateName: pensjon-kafka-inst-5774f66856-
  labels:
    app: pensjon-kafka-inst
    linkerd.io/control-plane-ns: linkerd
    linkerd.io/proxy-deployment: pensjon-kafka-inst
    linkerd.io/workload-ns: teampensjon
    pod-template-hash: 5774f66856
    team: teampensjon
  name: pensjon-kafka-inst-5774f66856-5rcww
  namespace: teampensjon
  ownerReferences:
  - apiVersion: apps/v1
    blockOwnerDeletion: true
    controller: true
    kind: ReplicaSet
    name: pensjon-kafka-inst-5774f66856
    uid: 5397fe83-8ead-4f00-8397-71270a51bce0
  resourceVersion: "1174567090"
  uid: e5655522-e13c-42e1-b501-e510faaf4ca8
spec:
  containers:
  - env:
    - name: _pod_name
      valueFrom:
        fieldRef:
          apiVersion: v1
          fieldPath: metadata.name
    - name: _pod_ns
      valueFrom:
        fieldRef:
          apiVersion: v1
          fieldPath: metadata.namespace
    - name: _pod_nodeName
      valueFrom:
        fieldRef:
          apiVersion: v1
          fieldPath: spec.nodeName
    - name: LINKERD2_PROXY_LOG
      value: warn,linkerd=info
    - name: LINKERD2_PROXY_LOG_FORMAT
      value: plain
    - name: LINKERD2_PROXY_DESTINATION_SVC_ADDR
      value: linkerd-dst-headless.linkerd.svc.cluster.local.:8086
    - name: LINKERD2_PROXY_DESTINATION_PROFILE_NETWORKS
      value: 10.0.0.0/8,100.64.0.0/10,172.16.0.0/12,192.168.0.0/16
    - name: LINKERD2_PROXY_POLICY_SVC_ADDR
      value: linkerd-policy.linkerd.svc.cluster.local.:8090
    - name: LINKERD2_PROXY_POLICY_WORKLOAD
      value: $(_pod_ns):$(_pod_name)
    - name: LINKERD2_PROXY_INBOUND_DEFAULT_POLICY
      value: all-unauthenticated
    - name: LINKERD2_PROXY_POLICY_CLUSTER_NETWORKS
      value: 10.0.0.0/8,100.64.0.0/10,172.16.0.0/12,192.168.0.0/16
    - name: LINKERD2_PROXY_INBOUND_CONNECT_TIMEOUT
      value: 100ms
    - name: LINKERD2_PROXY_OUTBOUND_CONNECT_TIMEOUT
      value: 1000ms
    - name: LINKERD2_PROXY_CONTROL_LISTEN_ADDR
      value: 0.0.0.0:4190
    - name: LINKERD2_PROXY_ADMIN_LISTEN_ADDR
      value: 0.0.0.0:4191
    - name: LINKERD2_PROXY_OUTBOUND_LISTEN_ADDR
      value: 127.0.0.1:4140
    - name: LINKERD2_PROXY_INBOUND_LISTEN_ADDR
      value: 0.0.0.0:4143
    - name: LINKERD2_PROXY_INBOUND_IPS
      valueFrom:
        fieldRef:
          apiVersion: v1
          fieldPath: status.podIPs
    - name: LINKERD2_PROXY_INBOUND_PORTS
      value: "8080"
    - name: LINKERD2_PROXY_DESTINATION_PROFILE_SUFFIXES
      value: svc.cluster.local.
    - name: LINKERD2_PROXY_INBOUND_ACCEPT_KEEPALIVE
      value: 10000ms
    - name: LINKERD2_PROXY_OUTBOUND_CONNECT_KEEPALIVE
      value: 10000ms
    - name: LINKERD2_PROXY_INBOUND_PORTS_DISABLE_PROTOCOL_DETECTION
      value: 25,587,3306,4444,5432,6379,9300,11211
    - name: LINKERD2_PROXY_DESTINATION_CONTEXT
      value: |
        {"ns":"$(_pod_ns)", "nodeName":"$(_pod_nodeName)"}
    - name: _pod_sa
      valueFrom:
        fieldRef:
          apiVersion: v1
          fieldPath: spec.serviceAccountName
    - name: _l5d_ns
      value: linkerd
    - name: _l5d_trustdomain
      value: cluster.local
    - name: LINKERD2_PROXY_IDENTITY_DIR
      value: /var/run/linkerd/identity/end-entity
    - name: LINKERD2_PROXY_IDENTITY_TRUST_ANCHORS
      value: |
        -----BEGIN CERTIFICATE-----
        MIIBjjCCATOgAwIBAgIQRwPd7XjJ+eEDoTdNU2YtGzAKBggqhkjOPQQDAjAlMSMw
        IQYDVQQDExpyb290LmxpbmtlcmQuY2x1c3Rlci5sb2NhbDAeFw0yMjA0MDgwOTE0
        NDVaFw0zMjA0MDUwOTE0NDVaMCUxIzAhBgNVBAMTGnJvb3QubGlua2VyZC5jbHVz
        dGVyLmxvY2FsMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEFCBKn3X5H/MNixah
        Ge1EyebCs2sxbKp2nkpBzXMwwx90J9/bV69PNvLJ77lKAkofSvy763/Ygs5qFk/U
        480fh6NFMEMwDgYDVR0PAQH/BAQDAgEGMBIGA1UdEwEB/wQIMAYBAf8CAQEwHQYD
        VR0OBBYEFE6jvCsuy34smjFwp7KQSrhYwfY8MAoGCCqGSM49BAMCA0kAMEYCIQDo
        qoIeoyIYUpcgUxBtnazRBbnvmNSNEQ4Tu3XaHltOFAIhAJoq+7vQHL19V4mez7+1
        kTChKewK90zMkKebh/s8KtXr
        -----END CERTIFICATE-----
    - name: LINKERD2_PROXY_IDENTITY_TOKEN_FILE
      value: /var/run/secrets/kubernetes.io/serviceaccount/token
    - name: LINKERD2_PROXY_IDENTITY_SVC_ADDR
      value: linkerd-identity-headless.linkerd.svc.cluster.local.:8080
    - name: LINKERD2_PROXY_IDENTITY_LOCAL_NAME
      value: $(_pod_sa).$(_pod_ns).serviceaccount.identity.linkerd.cluster.local
    - name: LINKERD2_PROXY_IDENTITY_SVC_NAME
      value: linkerd-identity.linkerd.serviceaccount.identity.linkerd.cluster.local
    - name: LINKERD2_PROXY_DESTINATION_SVC_NAME
      value: linkerd-destination.linkerd.serviceaccount.identity.linkerd.cluster.local
    - name: LINKERD2_PROXY_POLICY_SVC_NAME
      value: linkerd-destination.linkerd.serviceaccount.identity.linkerd.cluster.local
    - name: LINKERD2_PROXY_TAP_SVC_NAME
      value: tap.linkerd-viz.serviceaccount.identity.linkerd.cluster.local
    image: cr.l5d.io/linkerd/proxy:stable-2.11.1
    imagePullPolicy: IfNotPresent
    lifecycle:
      postStart:
        exec:
          command:
          - /usr/lib/linkerd/linkerd-await
      preStop:
        exec:
          command:
          - /bin/sleep
          - "10"
    livenessProbe:
      failureThreshold: 3
      httpGet:
        path: /live
        port: 4191
        scheme: HTTP
      initialDelaySeconds: 10
      periodSeconds: 10
      successThreshold: 1
      timeoutSeconds: 1
    name: linkerd-proxy
    ports:
    - containerPort: 4143
      name: linkerd-proxy
      protocol: TCP
    - containerPort: 4191
      name: linkerd-admin
      protocol: TCP
    readinessProbe:
      failureThreshold: 3
      httpGet:
        path: /ready
        port: 4191
        scheme: HTTP
      initialDelaySeconds: 2
      periodSeconds: 10
      successThreshold: 1
      timeoutSeconds: 1
    resources:
      limits:
        cpu: 200m
        memory: 500M
      requests:
        cpu: 10m
        memory: 10M
    securityContext:
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      runAsUser: 2102
    terminationMessagePath: /dev/termination-log
    terminationMessagePolicy: FallbackToLogsOnError
    volumeMounts:
    - mountPath: /var/run/linkerd/identity/end-entity
      name: linkerd-identity-end-entity
    - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
      name: kube-api-access-fpx8q
      readOnly: true
  - env:
    - name: NAIS_APP_NAME
      value: pensjon-kafka-inst
    - name: NAIS_NAMESPACE
      value: teampensjon
    - name: NAIS_APP_IMAGE
      value: docker.pkg.github.com/navikt/pensjon-kafka-inst/pensjon-kafka-inst:57ae546a5ea0fd05cdaf99daf6743de670399f4f
    - name: NAIS_CLUSTER_NAME
      value: dev-gcp
    - name: NAIS_CLIENT_ID
      value: dev-gcp:teampensjon:pensjon-kafka-inst
    - name: NAV_TRUSTSTORE_PATH
      value: /etc/ssl/certs/java/cacerts
    - name: NAV_TRUSTSTORE_PASSWORD
      value: changeme
    - name: START_WITHOUT_ENVOY
      value: "true"
    image: ghcr.io/navikt/pensjon-kafka-inst/pensjon-kafka-inst:57ae546a5ea0fd05cdaf99daf6743de670399f4f
    imagePullPolicy: IfNotPresent
    lifecycle:
      preStop:
        exec:
          command:
          - sleep
          - "5"
    livenessProbe:
      failureThreshold: 3
      httpGet:
        path: /isAlive
        port: 8080
        scheme: HTTP
      initialDelaySeconds: 20
      periodSeconds: 10
      successThreshold: 1
      timeoutSeconds: 60
    name: pensjon-kafka-inst
    ports:
    - containerPort: 8080
      name: http
      protocol: TCP
    readinessProbe:
      failureThreshold: 3
      httpGet:
        path: /isReady
        port: 8080
        scheme: HTTP
      initialDelaySeconds: 20
      periodSeconds: 10
      successThreshold: 1
      timeoutSeconds: 60
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 200m
        memory: 256Mi
    terminationMessagePath: /dev/termination-log
    terminationMessagePolicy: File
    volumeMounts:
    - mountPath: /etc/ssl/certs/java/cacerts
      name: ca-bundle-jks
      readOnly: true
      subPath: ca-bundle.jks
    - mountPath: /etc/ssl/certs/ca-certificates.crt
      name: ca-bundle-pem
      readOnly: true
      subPath: ca-bundle.pem
    - mountPath: /etc/pki/tls/certs/ca-bundle.crt
      name: ca-bundle-pem
      readOnly: true
      subPath: ca-bundle.pem
    - mountPath: /etc/ssl/ca-bundle.pem
      name: ca-bundle-pem
      readOnly: true
      subPath: ca-bundle.pem
    - mountPath: /etc/pki/tls/cacert.pem
      name: ca-bundle-pem
      readOnly: true
      subPath: ca-bundle.pem
    - mountPath: /etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem
      name: ca-bundle-pem
      readOnly: true
      subPath: ca-bundle.pem
    - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
      name: kube-api-access-fpx8q
      readOnly: true
  dnsPolicy: ClusterFirst
  enableServiceLinks: true
  hostAliases:
  - hostnames:
    - b27apvl00045.preprod.local
    ip: 10.183.160.26
  - hostnames:
    - b27apvl00046.preprod.local
    ip: 10.183.32.47
  - hostnames:
    - b27apvl00047.preprod.local
    ip: 10.183.32.48
  - hostnames:
    - b31dbvw005.oera-q.local
    ip: 10.49.1.52
  - hostnames:
    - b27apvl219.preprod.local
    ip: 10.53.17.117
  - hostnames:
    - b27apvl220.preprod.local
    ip: 10.53.17.118
  - hostnames:
    - b27apvl221.preprod.local
    ip: 10.53.17.119
  - hostnames:
    - b27apvl222.preprod.local
    ip: 10.53.17.120
  imagePullSecrets:
  - name: gpr-credentials
  - name: ghcr-credentials
  initContainers:
  - args:
    - --incoming-proxy-port
    - "4143"
    - --outgoing-proxy-port
    - "4140"
    - --proxy-uid
    - "2102"
    - --inbound-ports-to-ignore
    - 4190,4191,4567,4568
    - --outbound-ports-to-ignore
    - 4567,4568
    image: cr.l5d.io/linkerd/proxy-init:v1.4.0
    imagePullPolicy: IfNotPresent
    name: linkerd-init
    resources:
      limits:
        cpu: 100m
        memory: 50Mi
      requests:
        cpu: 10m
        memory: 10Mi
    securityContext:
      allowPrivilegeEscalation: false
      capabilities:
        add:
        - NET_ADMIN
        - NET_RAW
      privileged: false
      readOnlyRootFilesystem: true
      runAsNonRoot: false
      runAsUser: 0
    terminationMessagePath: /dev/termination-log
    terminationMessagePolicy: FallbackToLogsOnError
    volumeMounts:
    - mountPath: /run
      name: linkerd-proxy-init-xtables-lock
    - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
      name: kube-api-access-fpx8q
      readOnly: true
  nodeName: gke-dev-gcp-nais-pool-7056406b-rs6q
  preemptionPolicy: PreemptLowerPriority
  priority: 0
  restartPolicy: Always
  schedulerName: gke.io/optimize-utilization-scheduler
  securityContext: {}
  serviceAccount: pensjon-kafka-inst
  serviceAccountName: pensjon-kafka-inst
  terminationGracePeriodSeconds: 30
  tolerations:
  - effect: NoExecute
    key: node.kubernetes.io/not-ready
    operator: Exists
    tolerationSeconds: 300
  - effect: NoExecute
    key: node.kubernetes.io/unreachable
    operator: Exists
    tolerationSeconds: 300
  volumes:
  - configMap:
      defaultMode: 420
      name: ca-bundle-jks
    name: ca-bundle-jks
  - configMap:
      defaultMode: 420
      name: ca-bundle-pem
    name: ca-bundle-pem
  - name: kube-api-access-fpx8q
    projected:
      defaultMode: 420
      sources:
      - serviceAccountToken:
          expirationSeconds: 3607
          path: token
      - configMap:
          items:
          - key: ca.crt
            path: ca.crt
          name: kube-root-ca.crt
      - downwardAPI:
          items:
          - fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
            path: namespace
  - emptyDir: {}
    name: linkerd-proxy-init-xtables-lock
  - emptyDir:
      medium: Memory
    name: linkerd-identity-end-entity
status:
  conditions:
  - lastProbeTime: null
    lastTransitionTime: "2022-06-23T13:46:23Z"
    status: "True"
    type: Initialized
  - lastProbeTime: null
    lastTransitionTime: "2022-06-23T13:46:19Z"
    message: 'containers with unready status: [pensjon-kafka-inst]'
    reason: ContainersNotReady
    status: "False"
    type: Ready
  - lastProbeTime: null
    lastTransitionTime: "2022-06-23T13:46:19Z"
    message: 'containers with unready status: [pensjon-kafka-inst]'
    reason: ContainersNotReady
    status: "False"
    type: ContainersReady
  - lastProbeTime: null
    lastTransitionTime: "2022-06-23T13:46:19Z"
    status: "True"
    type: PodScheduled
  containerStatuses:
  - containerID: docker://c97b380eade4a2f1bc2aade7f47a4d04f25d4964f73fa3ddbb5b8d428321c71e
    image: cr.l5d.io/linkerd/proxy:stable-2.11.1
    imageID: docker-pullable://cr.l5d.io/linkerd/proxy@sha256:91b53d4b39e4c058e5fc63b72dd7ab6fe7f7051869ec5251dc9c0d8287b2771f
    lastState: {}
    name: linkerd-proxy
    ready: true
    restartCount: 0
    started: true
    state:
      running:
        startedAt: "2022-06-23T13:46:23Z"
  - image: ghcr.io/navikt/pensjon-kafka-inst/pensjon-kafka-inst:57ae546a5ea0fd05cdaf99daf6743de670399f4f
    imageID: ""
    lastState: {}
    name: pensjon-kafka-inst
    ready: false
    restartCount: 0
    started: false
    state:
      waiting:
        message: Back-off pulling image "ghcr.io/navikt/pensjon-kafka-inst/pensjon-kafka-inst:57ae546a5ea0fd05cdaf99daf6743de670399f4f"
        reason: ImagePullBackOff
  hostIP: 10.6.9.209
  initContainerStatuses:
  - containerID: docker://063bbeaa81af330e4a618cd7f06c1427b3b4e41c14f16c8a3b5643b8fc75a873
    image: cr.l5d.io/linkerd/proxy-init:v1.4.0
    imageID: docker-pullable://cr.l5d.io/linkerd/proxy-init@sha256:60d12fbb0b4a53962a5c2a59b496b3ee20052d26c0c56fd2ee38fd7fae62146e
    lastState: {}
    name: linkerd-init
    ready: true
    restartCount: 0
    state:
      terminated:
        containerID: docker://063bbeaa81af330e4a618cd7f06c1427b3b4e41c14f16c8a3b5643b8fc75a873
        exitCode: 0
        finishedAt: "2022-06-23T13:46:22Z"
        reason: Completed
        startedAt: "2022-06-23T13:46:21Z"
  phase: Pending
  podIP: 10.6.101.59
  podIPs:
  - ip: 10.6.101.59
  qosClass: Burstable
  startTime: "2022-06-23T13:46:19Z"
